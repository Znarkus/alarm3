<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<title>Alarm Clock</title>
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/main.css">
</head>
<body>


<label>
	<span>Alarm</span>
	<input id="alarm">
</label>

<div style="margin:0 0 10px;">
	<button id="set">Set</button>
	<button id="stop" style="display:none;">Stop</button>
	<button id="awake" style="display:none;">I'm awake!</button>
</div>

<pre id="status" class="loading">Loading...</pre>

<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.2.min.js"></script>
<script src="socket.io/socket.io.js"></script>
<script src="js/date.format.js"></script>
<script>

var socket = io.connect(/*'http://10.0.0.1:1337'*/);

function log(status) {
	$('#status').prepend('[' + (new Date()).format('d mmm HH:MM') + '] ' + status + '\n');
}

socket.on('init', function (data) {
	if ($('#status').hasClass('loading')) {
		$('#status').removeClass('loading').html('');
		log('Connected');
	}
	
	if (data.time) {
		$('#alarm').val(data.time);
	}
	
	if (data.triggered) {
		$('#stop').show();
	}
	
	if (data.canVerifyAwake) {
		('#awake').show();
	}
});

/*socket.on('disconnect', function () {
	log('Disconnected');
});*/

socket.on('connect_failed', function () {
	log("Couldn't connect");
});

socket.on('log', function (msg) {
	log(msg);
});

socket.on('set', function (data) {
	$('#alarm').val(new Date(data.next).format('HH:MM'));
	//log('Set to ' + $('#alarm').val());
});

socket.on('triggered', function () {
	//log('Triggered');
	$('#stop').show();
	$('#awake').hide();
});

socket.on('stop', function () {
	//log('Stopped');
	$('#stop').hide();
});

socket.on('verifyAwake', function () {
	$('#awake').show();
});

$('#awake').click(function () {
	socket.emit('awake');
	$(this).hide();
});

$('#set').click(function () {
	socket.emit('set', { time: $('#alarm').val() });
});

$('#stop').click(function () {
	socket.emit('stop');
});

</script>
</body>
</html>